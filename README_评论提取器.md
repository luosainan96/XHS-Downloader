# 小红书评论提取器 - 使用说明

## 🎯 功能介绍

自动提取小红书作品的评论信息，支持持久化登录状态，只需登录一次！

### ✨ 主要特性

- 🔐 **持久化登录** - 只需登录一次，自动保存登录状态
- 🤖 **浏览器自动化** - 使用Playwright模拟真实浏览器访问
- 📁 **智能文件组织** - 按作品标题和用户昵称分类保存
- 🖼️ **图片下载** - 自动提取评论中的图片URL
- ⏰ **完整信息** - 评论时间、用户信息、IP位置等

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install playwright aiofiles rich
playwright install chromium
```

### 2. 运行程序

```bash
python dynamic_comment_extractor.py
```

### 3. 首次使用

1. 程序会自动打开浏览器
2. 检测到未登录时，会引导您登录小红书
3. 登录完成后，程序自动继续提取评论
4. 登录状态会自动保存，下次无需重复登录

## 📂 文件结构

```
Comments_Dynamic/
├── browser_profile/          # 浏览器配置（持久化登录状态）
├── debug/                    # 调试数据
├── [作品标题]/               # 按作品标题创建的文件夹
│   ├── [用户昵称]/           # 按用户昵称创建的子文件夹
│   │   ├── 评论内容.txt      # 格式化的评论信息
│   │   └── 原始数据.json     # 完整的原始评论数据
│   ├── 作品信息.json         # 作品基本信息
│   └── 提取报告.txt          # 提取过程报告
```

## 📋 评论信息包含

- **用户信息**: 昵称、用户ID、头像URL
- **评论内容**: 完整的评论文字
- **时间信息**: 准确的评论时间戳
- **互动数据**: 点赞数、回复数
- **位置信息**: IP归属地
- **图片链接**: 评论中的图片URL

## ⚙️ 配置选项

在 `dynamic_comment_extractor.py` 中可以修改：

```python
# 选择要测试的链接
selected_url_index = 0  # 0: 成功链接, 1: 失败链接

# 初始化提取器
extractor = DynamicCommentExtractor(
    work_path="Comments_Dynamic",        # 保存目录
    cookie=cookie,                       # Cookie（可选）
    use_persistent_session=True          # 启用持久化登录
)
```

## 🔧 技术说明

### 核心技术栈
- **Playwright**: 浏览器自动化
- **AsyncIO**: 异步处理
- **Rich**: 美观的控制台输出
- **Aiofiles**: 异步文件操作

### 数据提取原理
1. 使用浏览器自动化访问小红书页面
2. 从 `window.__INITIAL_STATE__` 提取评论数据
3. 解析评论的用户信息、时间戳、内容等
4. 按照文件夹结构组织和保存数据

## 🛠️ 故障排除

### 页面加载超时
- 程序使用多层超时策略，会自动重试
- 如果网络不稳定，可能需要多次尝试

### 登录状态丢失
- 删除 `Comments_Dynamic/browser_profile` 目录
- 重新运行程序进行登录

### 评论提取失败
- 确保小红书账号处于正常登录状态
- 某些私密或受限制的笔记可能无法访问评论

## 📞 支持

如遇到问题，请检查：
1. 网络连接是否正常
2. 小红书账号是否能正常访问目标笔记
3. 浏览器是否能正常启动

---

**注意**: 本工具仅用于个人学习和研究用途，请遵守小红书的使用条款和相关法律法规。